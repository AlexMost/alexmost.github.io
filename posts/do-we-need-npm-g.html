<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Alexander Mostovenko blog - Do we need npm -g?</title>
        <link rel="stylesheet" type="text/css" href="../css/fonts.css" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <link rel="apple-touch-icon" sizes="57x57" href="../images/favicon/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="../images/favicon/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="../images/favicon/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="../images/favicon/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="../images/favicon/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="../images/favicon/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="../images/favicon/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="../images/favicon/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192" href="../images/favicon/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="../images/favicon/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon/favicon-16x16.png">
        <link rel="shortcut icon" href="../favicon.ico" />
        <link rel="manifest" href="../images/favicon/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Yet another developers blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Do we need npm -g?</h1>

            <div class="posted">
    Posted on May 18, 2016
    
</div>
<div class="info">
    
        Tags: <a href="../tags/javascript.html">javascript</a>, <a href="../tags/frontend.html">frontend</a>, <a href="../tags/webpack.html">webpack</a>, <a href="../tags/make.html">make</a>
    
</div>

<h2 id="the-problem">The problem</h2>
<p>Nowadays our projects are obtaining more and more build dependencies. In this article, I will be speaking from the frontend development perspective. But I think the same problem applies to other fields of development.</p>
<p>So very often, you are required to install some build deps globally via npm (grunt, gulp webpack, lint e.t.c). I am seeing that quite often in <em>README</em> files around github repositories. To my opinion that ‘-g’ option in npm is a pure evil and here are the main reasons:</p>
<ul>
<li>It’s one more additional step for setting up the new environment for building your assets.</li>
<li>Global dependencies are not included in the package.json file, so nobody is aware of what exact version of webpack(grunt, e.t.c) worked on your local machine, and your build can be broken with some new version.</li>
<li>Very often, to use -g option you need to add sudo and that is a real security vulnerability problem. It’s a great chance to add some evil script to npm install hook and stole all your nude photos.</li>
</ul>
<h2 id="why-not-to-use-make">Why not to use make?</h2>
<p>Makefiles originated in Unix-like systems and is still the primary software build mechanism there. They allow you to configure different rules for building your project. If you are not familiar, you can read more about all power of make here - <a href="http://www.gnu.org/software/make/manual/make.html">GNU make</a>. Don’t be afraid, for the frontend part, you need the only small subset of make abilities. Such as modifying environment variable, passing arguments, or setting up rules dependencies to control the execution order.</p>
<p>Here is the example of basic project build setup, assume you have decided to build your assets with webpack. So the first step is to create some new directory, cd to it and execute:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> init</code></pre></div>
<p>after that install webpack locally:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> install --save-dev webpack</code></pre></div>
<p>and here is a simple make file that will add your local <em>node_modules/.bin</em> to <em>PATH</em> and can launch all packages that are installed locally. This file contains one simple rule - <code>build</code>:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">SHELL</span> := /bin/bash
<span class="kw">export</span> <span class="ot">PATH</span> :<span class="ot">=</span> <span class="ot">$(</span><span class="kw">PWD</span><span class="ot">)</span>/node_modules/.bin:<span class="ot">$(</span><span class="kw">PATH</span><span class="ot">)</span>

<span class="kw">build</span>:
        <span class="kw">webpack</span></code></pre></div>
<blockquote>
<ul>
<li>First line here is used to make that thing working in OSX environment<br /></li>
<li>Second one adds our current directory (<em>node_modules/.bin</em>) to <em>PATH</em> variable</br></li>
<li>build is a make rule</li>
</ul>
</blockquote>
<p>so, for now, to build your static assets with webpack you have to execute:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">make</span> build</code></pre></div>
<p>With this simple make file we have no global dependencies (except node itself) and have fixed versions of our dev dependencies.</p>
<h2 id="npm-commands">Npm commands</h2>
<p>Also, you can use npm commands like <code>npm run</code>. This approach is a little bit less powerful than make but also works. More detailed instructions about npm run scripts - <a href="https://docs.npmjs.com/cli/run-script">here</a></p>
<h2 id="the-light-future">The light future</h2>
<p>The more advanced approach is to build all your assets inside some <em>docker</em> container or something similar. That will allow you to have a full control over the build environment. But this subject deserves a separate article.</p>
<div id="footer">
</div>
<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
     var disqus_config = function () {
     this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
     this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
     };
     */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//mostovenkocom.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

        </div>
        <div id="footer">
        </div>
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-573a3526f163b54b"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-77801339-1', 'auto');
            ga('send', 'pageview');

        </script>
    </body>
</html>
